import{_ as e,r as p,o,c,a as n,b as s,e as t,d as l}from"./app-75535683.js";const i={},r=n("h2",{id:"做微信公众号-扫二维码关注公众号并获取用户-逻辑",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#做微信公众号-扫二维码关注公众号并获取用户-逻辑","aria-hidden":"true"},"#"),s(" 做微信公众号 ，扫二维码关注公众号并获取用户-逻辑")],-1),u={href:"http://www.demodashi.com/demo/16402.html",target:"_blank",rel:"noopener noreferrer"},k=n("br",null,null,-1),d={href:"https://www.cnblogs.com/10zhan/p/17081299.html",target:"_blank",rel:"noopener noreferrer"},v=n("br",null,null,-1),b={href:"https://blog.csdn.net/shenshao_8/article/details/127407075",target:"_blank",rel:"noopener noreferrer"},m=n("br",null,null,-1),g={href:"https://www.freesion.com/article/63071075721/",target:"_blank",rel:"noopener noreferrer"},$=n("br",null,null,-1),f={href:"https://www.cnblogs.com/txw1958/p/weixin-qrcode-with-parameters.html",target:"_blank",rel:"noopener noreferrer"},w=n("br",null,null,-1),y={href:"https://www.likecs.com/show-200165.html",target:"_blank",rel:"noopener noreferrer"},q=n("br",null,null,-1),_={href:"http://demo.616zf.com/api/wx/valid",target:"_blank",rel:"noopener noreferrer"},h=l(`<hr><p>准备工作<br> 准备公众号及配置<br> 本文用测试公众号进行配置举例子</p><hr><blockquote><p>接口文档 获取access_token 文档：获取access_token 生成临时带参二维码 临时带参二维码方式进行生成二维码，再采用微信事件回调进行用户信息获取。 带参二维码生成文档：生成带参二维码 用户事件回调 用户在进行扫码或其他事件，微信会进行事件回调。 微信事件回调文档：微信事件回调 获取用户详细信息 获取用户详细信息：获取用户详细信息 程序目录 <img src="https://cdn.jsdelivr.net/gh/Justice996/picx-images-hosting@master/44ae262d901fe79a8ef90a0f96fa21c.35dqrj1q0ew0.webp" alt="44ae262d901fe79a8ef90a0f96fa21c"><img src="https://cdn.jsdelivr.net/gh/Justice996/picx-images-hosting@master/636440686be7d9d63bd5ec76a8645a4.6n1dk9el5bc0.webp" alt="636440686be7d9d63bd5ec76a8645a4"></p></blockquote><hr><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>获取access_token
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">$appid</span>
     * <span class="token keyword">@param</span> <span class="token parameter">$appsecret</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">mixed</span></span>
     * 获取token
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getToken</span><span class="token punctuation">(</span><span class="token variable">$appid</span><span class="token punctuation">,</span> <span class="token variable">$appsecret</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=&quot;</span> <span class="token operator">.</span> <span class="token variable">$appid</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&amp;secret=&quot;</span> <span class="token operator">.</span> <span class="token variable">$appsecret</span><span class="token punctuation">;</span>
        <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token function">request_get</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$access_token</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;access_token&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$access_token</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
获取二维码ticket
<span class="token doc-comment comment">/**
     * 获取关注二维码ticket
     * <span class="token keyword">@param</span>     <span class="token parameter">$ACCESS_TOKEN</span>
     * <span class="token keyword">@param</span>     <span class="token parameter">$fqid</span>
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token keyword">int</span></span> <span class="token parameter">$type</span>
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">bool</span><span class="token punctuation">|</span><span class="token keyword">string</span></span>
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">getQrcodeurl</span><span class="token punctuation">(</span><span class="token variable">$ACCESS_TOKEN</span><span class="token punctuation">,</span> <span class="token variable">$fqid</span><span class="token punctuation">,</span> <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$qrcode_url</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;access_token=&#39;</span> <span class="token operator">.</span> <span class="token variable">$ACCESS_TOKEN</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//生成永久二维码</span>
            <span class="token variable">$qrcode</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;{&quot;action_name&quot;: &quot;QR_LIMIT_SCENE&quot;, &quot;action_info&quot;: {&quot;scene&quot;: {&quot;scene_str&quot;: &#39;</span> <span class="token operator">.</span> <span class="token variable">$fqid</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;}}}&#39;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//生成临时二维码</span>
            <span class="token variable">$qrcode</span> <span class="token operator">=</span> <span class="token string single-quoted-string">&#39;{&quot;expire_seconds&quot;: 604800, &quot;action_name&quot;: &quot;QR_STR_SCENE&quot;, &quot;action_info&quot;: {&quot;scene&quot;: {&quot;scene_str&quot;: &#39;</span> <span class="token operator">.</span> <span class="token variable">$fqid</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;}}}&#39;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">http_post_data</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token variable">$qrcode</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$oo</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$oo</span><span class="token operator">-&gt;</span><span class="token property">ticket</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$oo</span><span class="token operator">-&gt;</span><span class="token property">ticket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">ErrorLogger</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;getQrcodeurl falied. Error Info: getQrcodeurl get failed&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$qrcode_get_url</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;ticket=&#39;</span> <span class="token operator">.</span> <span class="token variable">$oo</span><span class="token operator">-&gt;</span><span class="token property">ticket</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$oo</span><span class="token operator">-&gt;</span><span class="token property">ticket</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$url</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
* 保存二维码到服务器
* 可直接进行展示不进行存储，看业务需求
*
* <span class="token keyword">@param</span> <span class="token parameter">$url</span>
* <span class="token keyword">@param</span> <span class="token parameter">$filestring</span>
*
* <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">bool</span><span class="token punctuation">|</span><span class="token keyword">string</span></span>
*/</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">DownLoadQr</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token variable">$filestring</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$url</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$filestring</span> <span class="token operator">.</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">99999999999</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;.jpg&#39;</span><span class="token punctuation">;</span>
<span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*if (!file_exists(&#39;/public/qrcode/&#39; . $filename)) {
touch(&#39;/public/qrcode/&#39; . $filename);
}*/</span>
<span class="token variable">$file</span> <span class="token operator">=</span> <span class="token constant">PUBLIC_PATH</span> <span class="token operator">.</span> <span class="token string single-quoted-string">&#39;qrcode/&#39;</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
<span class="token variable">$fp2</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp2</span><span class="token punctuation">,</span> <span class="token variable">$img</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">ErrorLogger</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;dolwload image falied. Error Info: 无法写入图片&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token string single-quoted-string">&#39;/public/qrcode/&#39;</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
* 微信事件推送接收方法
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">responseMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token variable">$postStr</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;HTTP_RAW_POST_DATA&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;HTTP_RAW_POST_DATA&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;php://input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$postStr</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token variable">$postObj</span> <span class="token operator">=</span> <span class="token function">simplexml_load_string</span><span class="token punctuation">(</span><span class="token variable">$postStr</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">&#39;SimpleXMLElement&#39;</span><span class="token punctuation">,</span> <span class="token constant">LIBXML_NOCDATA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 微信消息类型</span>
<span class="token variable">$RX_TYPE</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$postObj</span><span class="token operator">-&gt;</span><span class="token property">MsgType</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$RX_TYPE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">case</span> <span class="token string double-quoted-string">&quot;text&quot;</span><span class="token punctuation">:</span>
<span class="token comment">// 文本消息</span>
<span class="token variable">$resultStr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">handleText</span><span class="token punctuation">(</span><span class="token variable">$postObj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token string double-quoted-string">&quot;event&quot;</span><span class="token punctuation">:</span>
<span class="token comment">// 事件推送</span>
<span class="token variable">$resultStr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">handleEvent</span><span class="token punctuation">(</span><span class="token variable">$postObj</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">default</span><span class="token punctuation">:</span>
<span class="token variable">$resultStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;Unknow msg type: &quot;</span> <span class="token operator">.</span> <span class="token variable">$RX_TYPE</span><span class="token punctuation">;</span>
<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token variable">$resultStr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
* 微信文本消息
* <span class="token keyword">@param</span> <span class="token parameter">$postObj</span>
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handleText</span><span class="token punctuation">(</span><span class="token variable">$postObj</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token variable">$fromUsername</span> <span class="token operator">=</span> <span class="token variable">$postObj</span><span class="token operator">-&gt;</span><span class="token property">FromUserName</span><span class="token punctuation">;</span>
<span class="token variable">$toUsername</span> <span class="token operator">=</span> <span class="token variable">$postObj</span><span class="token operator">-&gt;</span><span class="token property">ToUserName</span><span class="token punctuation">;</span>
<span class="token variable">$keyword</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$postObj</span><span class="token operator">-&gt;</span><span class="token property">Content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$textTpl</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;xml&gt;
&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
&lt;FuncFlag&gt;0&lt;/FuncFlag&gt;
&lt;/xml&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$keyword</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token variable">$msgType</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;text&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$contentStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;欢迎您关注&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$resultStr</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token variable">$textTpl</span><span class="token punctuation">,</span> <span class="token variable">$fromUsername</span><span class="token punctuation">,</span> <span class="token variable">$toUsername</span><span class="token punctuation">,</span> <span class="token variable">$time</span><span class="token punctuation">,</span> <span class="token variable">$msgType</span><span class="token punctuation">,</span> <span class="token variable">$contentStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$resultStr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;请输入...&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
* 获取时间消息并解析相应参数
* 提供数据简单推送(自动回复)
* <span class="token keyword">@param</span> <span class="token parameter">$object</span>
*
* <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handleEvent</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token variable">$contentStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">Event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">case</span> <span class="token string double-quoted-string">&quot;subscribe&quot;</span><span class="token punctuation">:</span>
<span class="token variable">$contentStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;感谢您关注【测试账号】&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$openid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">FromUserName</span><span class="token punctuation">;</span> <span class="token comment">//数据类型转换为字符串</span>
<span class="token variable">$refer_id</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;_&#39;</span><span class="token punctuation">,</span> <span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">EventKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//$object-&gt;EventKey返回的是qrsence_1232313这种类型</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createuserinfo</span><span class="token punctuation">(</span><span class="token variable">$openid</span><span class="token punctuation">,</span> <span class="token variable">$refer_id</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取用户信息</span>
<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token string double-quoted-string">&quot;SCAN&quot;</span><span class="token punctuation">:</span>
<span class="token variable">$contentStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;您已关注过，谢谢！&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$openid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">FromUserName</span><span class="token punctuation">;</span> <span class="token comment">//数据类型转换为字符串</span>
<span class="token variable">$refer_id</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;_&#39;</span><span class="token punctuation">,</span> <span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">EventKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//$object-&gt;EventKey返回的是qrsence_12213213这种类型</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createuserinfo</span><span class="token punctuation">(</span><span class="token variable">$openid</span><span class="token punctuation">,</span> <span class="token variable">$refer_id</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取用户信息</span>
<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$resultStr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">responseText</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">,</span> <span class="token variable">$contentStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$resultStr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
* 微信文本消息
* <span class="token keyword">@param</span> <span class="token parameter">$postObj</span>
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handleText</span><span class="token punctuation">(</span><span class="token variable">$postObj</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token variable">$fromUsername</span> <span class="token operator">=</span> <span class="token variable">$postObj</span><span class="token operator">-&gt;</span><span class="token property">FromUserName</span><span class="token punctuation">;</span>
<span class="token variable">$toUsername</span> <span class="token operator">=</span> <span class="token variable">$postObj</span><span class="token operator">-&gt;</span><span class="token property">ToUserName</span><span class="token punctuation">;</span>
<span class="token variable">$keyword</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$postObj</span><span class="token operator">-&gt;</span><span class="token property">Content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$textTpl</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;xml&gt;
&lt;ToUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/ToUserName&gt;
&lt;FromUserName&gt;&lt;![CDATA[%s]]&gt;&lt;/FromUserName&gt;
&lt;CreateTime&gt;%s&lt;/CreateTime&gt;
&lt;MsgType&gt;&lt;![CDATA[%s]]&gt;&lt;/MsgType&gt;
&lt;Content&gt;&lt;![CDATA[%s]]&gt;&lt;/Content&gt;
&lt;FuncFlag&gt;0&lt;/FuncFlag&gt;
&lt;/xml&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$keyword</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token variable">$msgType</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;text&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$contentStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;欢迎您关注&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$resultStr</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token variable">$textTpl</span><span class="token punctuation">,</span> <span class="token variable">$fromUsername</span><span class="token punctuation">,</span> <span class="token variable">$toUsername</span><span class="token punctuation">,</span> <span class="token variable">$time</span><span class="token punctuation">,</span> <span class="token variable">$msgType</span><span class="token punctuation">,</span> <span class="token variable">$contentStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$resultStr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;请输入...&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token doc-comment comment">/**
* 获取时间消息并解析相应参数
* 提供数据简单推送(自动回复)
* <span class="token keyword">@param</span> <span class="token parameter">$object</span>
*
* <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">string</span></span>
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handleEvent</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token variable">$contentStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">Event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">case</span> <span class="token string double-quoted-string">&quot;subscribe&quot;</span><span class="token punctuation">:</span>
<span class="token variable">$contentStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;感谢您关注【测试账号】&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$openid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">FromUserName</span><span class="token punctuation">;</span> <span class="token comment">//数据类型转换为字符串</span>
<span class="token variable">$refer_id</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;_&#39;</span><span class="token punctuation">,</span> <span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">EventKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//$object-&gt;EventKey返回的是qrsence_1232313这种类型</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createuserinfo</span><span class="token punctuation">(</span><span class="token variable">$openid</span><span class="token punctuation">,</span> <span class="token variable">$refer_id</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取用户信息</span>
<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token keyword">case</span> <span class="token string double-quoted-string">&quot;SCAN&quot;</span><span class="token punctuation">:</span>
<span class="token variable">$contentStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;您已关注过，谢谢！&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$openid</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">FromUserName</span><span class="token punctuation">;</span> <span class="token comment">//数据类型转换为字符串</span>
<span class="token variable">$refer_id</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;_&#39;</span><span class="token punctuation">,</span> <span class="token variable">$object</span><span class="token operator">-&gt;</span><span class="token property">EventKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//$object-&gt;EventKey返回的是qrsence_12213213这种类型</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">createuserinfo</span><span class="token punctuation">(</span><span class="token variable">$openid</span><span class="token punctuation">,</span> <span class="token variable">$refer_id</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取用户信息</span>
<span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$resultStr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">responseText</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">,</span> <span class="token variable">$contentStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token variable">$resultStr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6);function T(x,S){const a=p("ExternalLinkIcon");return o(),c("div",null,[r,n("blockquote",null,[n("p",null,[s("扫二维码关注公众号并获取用户-逻辑："),n("a",u,[s("http://www.demodashi.com/demo/16402.html"),t(a)]),s(),k,s(" 微信扫码登录能用代码 "),n("a",d,[s("https://www.cnblogs.com/10zhan/p/17081299.html"),t(a)]),v,s(" 关注取消事件回调位置 "),n("a",b,[s("https://blog.csdn.net/shenshao_8/article/details/127407075"),t(a)]),m,s(" 提交基础信息，就会当场样子接口"),n("a",g,[s("https://www.freesion.com/article/63071075721/"),t(a)]),$,s(" 要提前写完验证代码"),n("a",f,[s("https://www.cnblogs.com/txw1958/p/weixin-qrcode-with-parameters.html"),t(a)]),w,s(" 回调细节-"),n("a",y,[s("https://www.likecs.com/show-200165.html"),t(a)]),q,s(" Token验证例子微信扫码"),n("a",_,[s("http://demo.616zf.com/api/wx/valid"),t(a)])])]),h])}const E=e(i,[["render",T],["__file","basic.html.vue"]]);export{E as default};
